---
# Install kubectl

 - name: Download latest kubectl
   shell: "https_proxy={{ proxy }} curl -LO https://storage.googleapis.com/kubernetes-release/release/$(https_proxy={{ proxy }} curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"

 - name: Make the kubectl binary executable
   file:
     path: ./kubectl
     mode: 775

 - name: Move the kubectl binary to PATH
   command: "mv ./kubectl /usr/local/bin/kubectl"
   become: yes

 - name: Add Kubernetes repo
   copy: src=./files/kubernetes.repo dest=/etc/yum.repos.d/.
   become: yes

 - name: Install kubelet
   yum:
     name: kubelet
     state: latest
   become: yes

 - name: Install kubeadm
   yum:
     name: kubeadm
     state: latest
   become: yes

 - name: Enable and start kubelet
   systemd:
     state: started
     name: kubelet
     enabled: yes
   become: yes
